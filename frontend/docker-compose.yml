version: '3.8'

services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    image: toomas633-frontend:latest
    container_name: toomas633-frontend
    ports:
      - '80:80'
    environment:
      # You can override build-time env vars here if needed
      - NODE_ENV=production
      # GitHub token for repository data (optional)
      - VITE_GITHUB_TOKEN=${VITE_GITHUB_TOKEN:-}
      # Backend API URL (required for backend communication)
      - VITE_API_URL=${VITE_API_URL:-http://localhost:3000/api}
    healthcheck:
      test:
        [
          'CMD',
          'wget',
          '--no-verbose',
          '--tries=1',
          '--spider',
          'http://localhost/',
        ]
      interval: 30s
      timeout: 3s
      start_period: 5s
      retries: 3
    restart: unless-stopped
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.frontend.rule=Host(`localhost`)'
      - 'traefik.http.services.frontend.loadbalancer.server.port=80'
    volumes:
      # Optional: mount custom nginx config
      # - ./nginx.conf:/etc/nginx/nginx.conf:ro
      # Optional: mount logs for debugging
      # - ./logs:/var/log/nginx
    networks:
      - frontend-network

  # Optional: Add a reverse proxy for production
  # nginx-proxy:
  #   image: nginx:alpine
  #   container_name: nginx-proxy
  #   ports:
  #     - "443:443"
  #   volumes:
  #     - ./nginx-proxy.conf:/etc/nginx/nginx.conf:ro
  #     - ./ssl:/etc/nginx/ssl:ro
  #   depends_on:
  #     - frontend
  #   networks:
  #     - frontend-network

networks:
  frontend-network:
    driver: bridge
# Optional: Add volumes for persistent data
# volumes:
#   nginx-logs:
#     driver: local
